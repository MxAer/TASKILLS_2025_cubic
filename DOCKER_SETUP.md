# Docker Setup: Full Stack ั Hot Reload

## ๐ ะะฐะบ ะทะฐะฟัััะธัั ะฒัั ัะธััะตะผั ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน

### ะขัะตะฑะพะฒะฐะฝะธั
- Docker Desktop ัััะฐะฝะพะฒะปะตะฝ ะธ ะทะฐะฟััะตะฝ
- Git (ะดะปั ะบะปะพะฝะธัะพะฒะฐะฝะธั ัะตะฟะพะทะธัะพัะธั)

### ะจะฐะณะธ

#### 1. ะัะธััะธัะต ััะฐััะต ะบะพะฝัะตะนะฝะตัั (ะตัะปะธ ะฑัะปะธ)
```powershell
docker-compose down
```

#### 2. ะกะพะฑะตัะธัะต ะธ ะทะฐะฟัััะธัะต ะฒัั
```powershell
docker-compose up --build
```

ะะตัะฒัะน ะทะฐะฟััะบ ะทะฐะนะผะตั **2-5 ะผะธะฝัั**, ัะฐะบ ะบะฐะบ:
- ะกะบะฐัะธะฒะฐะตััั ะพะฑัะฐะท Node.js
- ะกะบะฐัะธะฒะฐะตััั ะพะฑัะฐะท PostgreSQL, Redis, Go
- ะัะฟะพะปะฝัะตััั `npm install` ะดะปั ะทะฐะฒะธัะธะผะพััะตะน ััะพะฝัะตะฝะดะฐ
- ะะพะผะฟะธะปะธััะตััั Go ะฑัะบะตะฝะด

#### 3. ะะพะถะดะธัะตัั ะปะพะณะพะฒ ััะฟะตัะฐ
ะัะธัะต ะฒ ัะตัะผะธะฝะฐะปะต:
```
dice_backend  | Server starting on :8080
dice_frontend | โ  Local:   http://0.0.0.0:5173/
```

#### 4. ะัะบัะพะนัะต ะฑัะฐัะทะตั
ะะตัะตะนะดะธัะต ะฝะฐ: `http://localhost:5173`

---

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ   ะะะจ ะะะะฃะะะ   โ
โ localhost:5173  โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  FRONTEND CONTAINER โ
โ  (Vue + Vite)       โ
โ  Port: 5173         โ
โ  Volume: ./frontend โโโโโโ Hot Reload: ัะตะดะฐะบัะธััะน ัะฐะนะปั ะปะพะบะฐะปัะฝะพ
โโโโโโโโโโฌโโโโโโโโโโโโโ
         โ /api requests
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  BACKEND CONTAINER  โ
โ  (Go + Chi)         โ
โ  Port: 8080         โ
โ  Volume: ./backend  โโโโโโ ะะพัะพะฒะพ ะบ Hot Reload (Air)
โโโโโโโโโโฌโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  DATABASE CONTAINER โ
โ  (PostgreSQL)       โ
โ  Port: 5432         โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Hot Reload (ะฐะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต)

### ะคัะพะฝัะตะฝะด
1. ะััะตะดะฐะบัะธััะนัะต ัะฐะนะป ะฒ `frontend/src/` (ะฝะฐะฟัะธะผะตั, `App.vue`)
2. ะกะพััะฐะฝะธัะต ัะฐะนะป
3. **ะะฒัะพะผะฐัะธัะตัะบะธ** ะฑัะฐัะทะตั ะพะฑะฝะพะฒะธััั (ัะตัะตะท Vite HMR)

### ะัะบะตะฝะด (ะฑัะดััะตะต)
ะ ะฑัะดััะตะผ ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั [Air](https://github.com/cosmtrek/air) ะดะปั Go hot reload.

---

## ๐ ะะพะผะฐะฝะดั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะบะพะฝัะตะนะฝะตัะฐะผะธ

### ะััะฐะฝะพะฒะธัั ะฒัั
```powershell
docker-compose down
```

### ะะฐะฟัััะธัั ะฑะตะท ะฟะตัะตัะฑะพัะบะธ
```powershell
docker-compose up
```

### ะะตัะตัะพะฑัะฐัั ะธ ะทะฐะฟัััะธัั ะฒ ัะพะฝะต
```powershell
docker-compose up --build -d
```

### ะะพัะผะพััะตัั ะปะพะณะธ ะฒัะตั ัะตัะฒะธัะพะฒ
```powershell
docker-compose logs -f
```

### ะะพะณะธ ะบะพะฝะบัะตัะฝะพะณะพ ัะตัะฒะธัะฐ
```powershell
docker-compose logs -f frontend
docker-compose logs -f backend
docker-compose logs -f db
```

### ะะพะดะบะปััะธัััั ะบ ะะ (PostgreSQL)
```powershell
docker exec -it dice_db psql -U dice_user -d dice_db
```

ะะฝัััะธ `psql`:
```sql
SELECT * FROM users;
SELECT * FROM rooms;
\dt  -- ัะฟะธัะพะบ ัะฐะฑะปะธั
```

### ะัะพะด ะฒ ะบะพะฝัะตะนะฝะตั ะดะปั ะพัะปะฐะดะบะธ
```powershell
docker exec -it dice_frontend sh
docker exec -it dice_backend sh
```

---

## ๐ Troubleshooting

### ะะพัั 5173 ัะถะต ะทะฐะฝัั
```powershell
# ะะฐะนัะธ ะฟัะพัะตัั, ะบะพัะพััะน ะธัะฟะพะปัะทัะตั ะฟะพัั
netstat -ano | findstr :5173

# ะฃะฑะธัั ะฟัะพัะตัั (ะทะฐะผะตะฝะธัะต PID ะฝะฐ ัะธัะปะพ ะธะท ะฒัะฒะพะดะฐ ะฒััะต)
taskkill /PID <PID> /F
```

### npm install ะฝะต ัะฐะฑะพัะฐะตั
ะฃะดะฐะปะธัะต `node_modules` ะธ `package-lock.json`:
```powershell
rm -r frontend/node_modules frontend/package-lock.json
docker-compose up --build
```

### ะะทะผะตะฝะตะฝะธั ะฒ ะบะพะดะต ะฝะต ะพััะฐะถะฐัััั (Hot Reload ะฝะต ัะฐะฑะพัะฐะตั)
ะฃะฑะตะดะธัะตัั, ััะพ ะฒ `docker-compose.yml` ัััะฐะฝะพะฒะปะตะฝะฐ ะฟะตัะตะผะตะฝะฝะฐั:
```yaml
environment:
  - CHOKIDAR_USEPOLLING=true
```

### ะะ ะฝะต ะธะฝะธัะธะฐะปะธะทะธััะตััั
ะัะพะฒะตัััะต ัะฐะนะป `migrations/01_init.sql`. ะะพะณะธ:
```powershell
docker-compose logs db
```

---

## โ ะัะพะฒะตัะบะฐ ัะธััะตะผั

ะะพัะปะต `docker-compose up --build`:

1. **ะคัะพะฝัะตะฝะด ะดะพัััะฟะตะฝ?**
   - ะัะบัะพะนัะต `http://localhost:5173`
   - ะะพะปะถะฝั ัะฒะธะดะตัั ะบะฝะพะฟะบั "ROLL DICE"

2. **ะัะบะตะฝะด ะดะพัััะฟะตะฝ?**
   ```powershell
   curl http://localhost:8080/api/me
   ```
   ะัะฒะตั: `You are user ID: <uuid>`

3. **ะะ ัะฐะฑะพัะฐะตั?**
   ```powershell
   docker exec -it dice_db psql -U dice_user -d dice_db -c "SELECT 1"
   ```
   ะัะฒะตั: `1`

4. **Redis ัะฐะฑะพัะฐะตั?**
   ```powershell
   docker exec -it dice_redis redis-cli ping
   ```
   ะัะฒะตั: `PONG`

---

## ๐ ะะฐะทะฒะธัะธะต

ะะปั ะดะพะฑะฐะฒะปะตะฝะธั Go Hot Reload ัะตัะตะท Air:

1. ะะพะฑะฐะฒััะต `air` ะฒ `backend/Dockerfile`:
   ```dockerfile
   RUN go install github.com/cosmtrek/air@latest
   ```

2. ะกะพะทะดะฐะนัะต `backend/.air.toml`

3. ะะทะผะตะฝะธัะต CMD ะฒ Dockerfile ะฝะฐ:
   ```dockerfile
   CMD ["air"]
   ```

ะขะพะณะดะฐ ะปัะฑัะต ะธะทะผะตะฝะตะฝะธั ะฒ `backend/*.go` ะฑัะดัั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตัะพะฑะธัะฐัััั.
